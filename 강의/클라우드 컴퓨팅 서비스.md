#클라우드

---
클라우드 컴퓨팅 서비스
개인이나 기업이 소프트웨어 인프라를 쉽게 구축하고 관리할 수 있도록 해주는 서비스

아마존 웹 서비스(AWS) -> 2006년부터.

개발자만 접속 가능하고, 외부의 사용자가 접속할 수 없는 구조
- 어플리케이션 빌드(프로그램 코드를 컴퓨터가 실행할 수 있는 파일로 변환)
- 서버에 배포를 하면 외부 사용자도 접속 가능

서버 환경을 어떻게 구축하는가?
1. 온프레미스(On-Premise) 방식
	: 장비를 구입하고, 네트워크 환경을 구축해서 장비를 다룰 수 있는 엔지니어를 고용하여 운영 관리
	: 기술적, 경제적, 시간적 비용 발생
	
2. 클라우드 컴퓨팅 방식
	AWS 웹 어플리케이션 접속, 몇 가지 입력만으로 서버환경을 구축


###### 1. 프로젝트 빌드
1-1. 프론트엔드 프로젝트 빌드

프론트엔드 빌드 파일 이동 자동화
-> static

 mv모듈 설치
 `npm i mv@2.1.1 -D `


해당 프로젝트 디렉토리에서 터미널 열고 실행: `npm run build`
-> dist 디렉토리에 작업 내용 생성됨

dist 내부의 모든 파일들을 src/main/resources/static 으로 이동
-> 이제 localhost:8080으로 프론트+백 통합됨

MainController 수정
```java
@Controller  
public class MainController {  
  
    @GetMapping(value = {"/", "{path:[^.]*}", "{path1:[^.]*}/{path2:[^.]*}"})  
    public String index() {  
        return "/index.html";  
    }  
}
```
index.html로 처음 화면 연결

백엔드 빌드 파일 생성

터미널에 `./gradlew bootJar` 입력
-> build/libs 폴더에 .jar 파일 생성 완료(최종 배포 파일!)

###### 2. AWS EC2 생성
AWS 가입 후(프리 티어 권장) EC2 생성, 인스턴스 시작

Ubuntu 선택 (24.04 LTS)

t2.micro 선택 (다른 것도 가능, 프리 티어 가능 여부 확인)

키 페어 생성 - RSA, .pem 사용 -> 잘 보관해놓기

방화벽 - SSH, HTTPS 트래픽 허용 다 체크

스토리지 구성 - 8GiB gp3 (프리 티어 사용)

인스턴스 시작
 : 퍼블릭 DNS 주소 확인(외부에서 접속할 주소)

###### 3. 서비스 환경 구축
SFTP 접속

IntelliJ(Ultimate) -> Tools -> Deployment -> Remote Host 
Add Host -> 이름 입력, SFTP 선택
SSH Configurations 설정
Host : AWS EC2에서 복사한 퍼블릭 DNS 주소 입력
	SSH 포트는 22번
Username : ubuntu (고정)
인증방식 : Key pair
키 위치 : 로컬에 저장한 키.pem

커넥션 테스트 진행 
완료되면 그대로 복사해서 이름 변경 : study-root
	root 사용자(관리자)로 사용할 커넥션
Use sudo ~ 체크박스 체크하고 완료

Tools -> Start SSH Session 으로 접속 가능

터미널이 잘 표시되면 입력 :
`sudo apt update`

완료되면 jdk 설치를 위해 입력 :
`sudo apt-get install openjdk-21-jdk -y`

설치 완료 확인 : 
`java -version`


###### 4. 원격 DB 접속
AWS EC2 Ubuntu에서 MySQL 8.0 설치

패키지 업데이트 
`sudo apt-get update`
`sudo apt-get upgrade -y`

MySQL APT 저장소 추가
`wget https://dev.mysql.com/get/mysql-apt-config_0.8.22-1_all.deb`

config 설정 
`sudo dpkg -i mysql-apt-config_0.8.22-1_all.deb`
  
설치중 설정 화면에서 8.0 선택 
OK 선택

APT 패키지 리스트 업데이트
`sudo apt-get update`

MySQL 8.0 설치
`sudo apt-get install mysql-server -y`

MySQL 서버시작
`sudo systemctl start mysql`

MySQL 서버 자동 시작 설정 (재부팅 시 자동 실행)
`sudo systemctl enable mysql`

MySQL 설치 확인
`mysql --version`

MySQL 서비스 상태 확인
`sudo systemctl status mysql`

root 보안 설정 (비밀번호 설정)
`sudo mysql_secure_installation`

```
| Validate Password Plugin?         | n 
| New root password?                | 원하는 비밀번호 입력(Key pair 사용시 없음) 
| Remove Anonymous Users?           | y               
| Disallow root remote login?       | y              
| Remove test DB?                   | y                
| Reload privileges now?            | y     
```

MySQL 접속 
`sudo mysql -u root -p`

외부 접속 허용 설정
`sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf`

`bind-address = 0.0.0.0  수정 후 저장 종료 (ctrl + O-> Enter-> ctrl + X)`

root 외부 접속 권한 부여
`ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '원하는비번';`
`FLUSH PRIVILEGES;`
 
재시작: 
`sudo systemctl restart mysql`

###### 5. 웹 서버 설치
nginx 설치
`sudo apt-get install nginx -y`

서버 실행 시 enable 설정
`sudo systemctl enable nginx`

상태 확인
`sudo systemctl status nginx`




