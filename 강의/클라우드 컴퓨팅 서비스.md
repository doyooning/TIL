#AWS

---
**클라우드 컴퓨팅 서비스**
개인이나 기업이 소프트웨어 인프라를 쉽게 구축하고 관리할 수 있도록 해주는 서비스

아마존 웹 서비스(AWS) -> 2006년부터.

개발자만 접속 가능하고, 외부의 사용자가 접속할 수 없는 구조
- 어플리케이션 빌드(프로그램 코드를 컴퓨터가 실행할 수 있는 파일로 변환)
- 서버에 배포를 하면 외부 사용자도 접속 가능

서버 환경을 어떻게 구축하는가?
1. 온프레미스(On-Premise) 방식
	: 장비를 구입하고, 네트워크 환경을 구축해서 장비를 다룰 수 있는 엔지니어를 고용하여 운영 관리
	: 기술적, 경제적, 시간적 비용 발생
	
2. 클라우드 컴퓨팅 방식
	AWS 웹 어플리케이션 접속, 몇 가지 입력만으로 서버환경을 구축

---
### 1. 프로젝트 빌드
1-1. 프론트엔드 프로젝트 빌드

프론트엔드 빌드 파일 이동 자동화
-> static

 mv모듈 설치
 `npm i mv@2.1.1 -D `

해당 프로젝트 디렉토리에서 터미널 열고 실행: `npm run build`
-> dist 디렉토리에 작업 내용 생성됨

dist 내부의 모든 파일들을 src/main/resources/static 으로 이동
-> 이제 localhost:8080으로 프론트+백 통합됨

MainController 수정
```java
@Controller  
public class MainController {  
  
    @GetMapping(value = {"/", "{path:[^.]*}", "{path1:[^.]*}/{path2:[^.]*}"})  
    public String index() {  
        return "/index.html";  
    }  
}
```
index.html로 처음 화면 연결

백엔드 빌드 파일 생성

터미널에 `./gradlew bootJar` 입력
-> build/libs 폴더에 .jar 파일 생성 완료(최종 배포 파일!)

---
### 2. AWS EC2 생성
AWS 가입 후(프리 티어 권장) EC2 생성, 인스턴스 시작

Ubuntu 선택 (24.04 LTS)

t2.micro 선택 (다른 것도 가능, 프리 티어 가능 여부 확인)

키 페어 생성 - RSA, .pem 사용 -> 잘 보관해놓기

방화벽 - SSH, HTTPS 트래픽 허용 다 체크

스토리지 구성 - 8GiB gp3 (프리 티어 사용)

인스턴스 시작
 : 퍼블릭 DNS 주소 확인(외부에서 접속할 주소)

---
### 3. 서비스 환경 구축
SFTP 접속

IntelliJ(Ultimate) -> Tools -> Deployment -> Browse Remote Host 
Add Host -> 이름 입력, SFTP 선택
SSH Configurations 설정
Host : AWS EC2에서 복사한 퍼블릭 DNS 주소 입력
	SSH 포트는 22번
Username : ubuntu (고정)
인증방식 : Key pair
키 위치 : 로컬에 저장한 키.pem

커넥션 테스트 진행 
완료되면 그대로 복사해서 이름 변경 : study-root
	root 사용자(관리자)로 사용할 커넥션
Use sudo ~ 체크박스 체크하고 완료

Tools -> Start SSH Session 으로 접속 가능

터미널이 잘 표시되면 입력 :
`sudo apt update`

완료되면 jdk 설치를 위해 입력 :
`sudo apt-get install openjdk-21-jdk -y`

설치 완료 확인 : 
`java -version`

---
### 4. 원격 DB 접속
AWS EC2 Ubuntu에서 MySQL 8.0 설치

패키지 업데이트 
`sudo apt-get update`
`sudo apt-get upgrade -y`

MySQL APT 저장소 추가
`wget https://dev.mysql.com/get/mysql-apt-config_0.8.22-1_all.deb`

config 설정 
`sudo dpkg -i mysql-apt-config_0.8.22-1_all.deb`

```
The detected system (ubuntu noble) is not supported by MySQL. If you believe the platform is compatible with one of the supported systems, one of the corresponding repositories may be selected.

  1.  debian buster  2. ubuntu bionic  3. ubuntu focal  4. ubuntu hirsute  5. ubuntu impish  6. debian bullseye  7. abort

Add repository to unsupported system?
```
-> 7 abort 선택

설치중 설정 화면에서 8.0 선택 
OK 선택

APT 패키지 리스트 업데이트
`sudo apt-get update`

MySQL 8.0 설치
`sudo apt-get install mysql-server -y`

MySQL 서버시작
`sudo systemctl start mysql`

MySQL 서버 자동 시작 설정 (재부팅 시 자동 실행)
`sudo systemctl enable mysql`

MySQL 설치 확인
`mysql --version`

MySQL 서비스 상태 확인
`sudo systemctl status mysql`

root 보안 설정 (비밀번호 설정)
`sudo mysql_secure_installation`

```
| Validate Password Plugin?         | n 
| New root password?                | 원하는 비밀번호 입력(Key pair 사용시 없음) 
| Remove Anonymous Users?           | y               
| Disallow root remote login?       | y              
| Remove test DB?                   | y                
| Reload privileges now?            | y     
```

MySQL 접속 
`sudo mysql -u root -p`

외부 접속 허용 설정
`sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf`

`bind-address = 0.0.0.0  수정 후 저장 종료 (ctrl + O-> Enter-> ctrl + X)`

root 외부 접속 권한 부여
`ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '원하는비번';`
`FLUSH PRIVILEGES;`
 
재시작: 
`sudo systemctl restart mysql`

---
### 5. 웹 서버 설치
nginx 설치
`sudo apt-get install nginx -y`

서버 실행 시 enable 설정
`sudo systemctl enable nginx`

상태 확인
`sudo systemctl status nginx`

https로 접근하면 보안상의 문제로 접근이 제한되므로,
주소창에 DNS주소 또는 IP주소 입력 후 http 프로토콜로 바꿔준다.
-> 웹 서버 구동 성공시 "Welcome to nginx!" 페이지 표시

이후에 진행할 MySQL DB 커넥션(3306 포트)을 허용해주기 위해, 
AWS EC2에서 인바운드 규칙을 추가해준다.

인스턴스 -> '보안' 탭에서 '보안 그룹' 클릭(launch-wizard-1)
인바운드 규칙 편집 -> 규칙 추가 -> 유형 MySQL/Aurora -> 소스 Anywhere IPv4(0.0.0.0/0)
수정 완료

---
### 6. 사용자 생성
MySQL 접속
`sudo mysql -u root -p`

유저 생성
`create user 'ssg'@'%' identified by 'Ssgmysql1234!';`
-> 비번 규칙 때문에 맨 앞에 대문자 ...
`create user 'ssg'@'localhost' identified by 'ssgmysql1234!';`

유저에 권한 부여
`grant all privileges on *.* to 'ssg'@'%' with grant option;`
`grant all privileges on *.* to 'ssg'@'localhost' with grant option;`
`flush privileges;`

유저 확인
`select host, user from mysql.user;`
`quit`

IntelliJ Database -> Properties 에서 Connection 생성
Host : public DNS 주소 입력
Post : 3306
	User : ssg (아까 권한 부여해준 유저)
Password : Ssgmysql1234! (아까 설정해준 비번)
	`'ssg'@'%'` 로 만들어준 계정

---
### 7. localhost -> AWS RDS로 DB 옮기기

AWS 커넥션에 우클릭 -> New -> Schema

Collation : `utf8mb4_general_ci` 선택

스키마 만들어지면 테이블 만들고 데이터 집어넣기

---
### 8. 배포

Tools -> Start SSH Session(터미널 열기)

home/ubuntu/applications/gallery를 만들어주어야 함

명령어 입력(계속):
`cd ~`
`cd .. cd .. pwd` -> / 가 되면
`cd /home/ubuntu`

`mkdir applications`
applications에서 `mkdir gallery`

프로젝트 안에 있는 .jar 파일을 applications/gallery로 드래그 & 드롭
`java -jar gallery-0.0.1-SNAPSHOT.jar`


리눅스에서는 설치파일들은 etc 디렉토리 안에 설치된다.
etc/nginx/sites-enabled에 파일 생성 : `default.conf`
(이미 파일이 존재하면 삭제하고 새로 생성)
```
server { 
	listen 80; 
	server_name "Public DNS 주소 입력"; 
	location / { 
	proxy_pass http://127.0.0.1:8080;
	proxy_http_version 1.1; 
	proxy_set_header Upgrade $http_upgrade; 
	proxy_set_header Connection "upgrade"; 
	proxy_set_header Host $host; 
	proxy_set_header X-Real-IP $remote_addr; 
	proxy_cache_bypass $http_upgrade; 
	} 
}
```
작성하고 업로드 눌러줘야 반영됨
-> study-root랑 study랑 동기화

리버스 프록시 설정
웹 어플리케이션에 접속할 수 없는 이유?
-> AWS 서버 인스턴스의 방화벽에서 웹 어플리케이션이 사용하는 8080 포트를 허용하지 않음
- 새로운 방화벽 규칙을 추가
- 웹 서버인 Nginx에 리버스 프록시를 활용해서 해결

리버스 프록시란?

로드 밸런싱 - 부하를 분산시킴

일단 jar 파일의 application.properties도 수정이 필요하다.
localhost 대신에 퍼블릭 DNS나 IP주소 입력
username : ssg
password : Ssgmysql1234!

다시 빌드 후, applications/gallery에 넣어줌

배포 파일 가동
`nohup java -jar gallery-0.0.1-SNAPSHOT.jar &`


---
### Naver Cloud Platform
클라우드 컴퓨팅 모델
1. 관련 범위에 따른 분류
	: IaaS, PaaS, SaaS
2. Deployment에 따른 분류
	: Public Cloud, Private Cloud, Hybrid Cloud, Multi Cloud

관련 범위에 따라 4가지 모델로 분류:
On-Premise, IaaS, PaaS, SaaS
<<< CSP 영역 순서 <<<

클라우드 서비스 프로바이더의 역사

![[cloud-service-provider.jpg]]
네이버는 아마존보다 무려 11년 뒤에(...) 서비스 제공

### 네이버 클라우드 구조도
![[naver-cloud-platform.jpg]]
네이버 클라우드는 Classic과 VPC 2가지 서비스로 구분
VPC는 보안 아키텍처를 구성하는 데 필수적이므로 VPC 선택

**VPC** : Virtual Private Compute
네트워크 망을 더 작은 네트워크 단위인 서브넷으로 나눌 수 있음
Private 서브넷, Public 서브넷으로 나누어짐
	Private 서브넷 : 웹 서버, DB 서버 배치
	Public 서브넷 : 배스천 호스트(Bastion Host) 서버 배치, 이를 통해서 서버(Port 22) 및 DB 서버에 접근
		-> 서버에 직접 접근하는 것보다 배스천 호스트를 통해 간접 접근하는 것이 보안성 높임

**ACG** : Access Control Group
방화벽에 해당, 배스천 호스트 서버 ACG에는 서버 운영자의 IP만 접근할 수 있도록 설정
Private 서브넷에 있는 서버와 DB의 ACG에는 배스천 호스트의 사설 IP만 접근을 허용

**공인 IP 및 사설 IP**
==공인 IP :== 
Public 서브넷에 위치하는 서버에게 할당
배스천 호스트 서버는 공인 IP를 할당 받음, 인터넷 게이트 통해 인터넷에 연결

==사설 IP :==
이미 특정 숫자가 정해져 있음
Private 서브넷에 위치한 서버 또는 DB는 공인 IP가 아닌 사설 IP를 사용함
이 서버가 인터넷에 연결하기 위해서는 라우팅 테이블 통해 Public 서브넷에 위치한 NAT 게이트웨이 통해서 가능


**서버, 이중화, 서버이미지**
==서버 :==
Private 서브넷에 위치시킴, ACG에서는 배스천 호스트의 Private IP 및 22포트, 로드밸런서의 Private IP와 80포트를 허용
배스천 호스트로 접근하는 이유는 서버에 SSH로 접속해서 Github로부터 소스코드를 다운로드 받기 위함
로드밸런서로 접근하는 이유는 프론트엔드에서 서버와 직접 API 통신을 하는 것이 아닌 로드밸런서와 통신하기 때문

==서버 이중화 :==
서로 다른 가용존에 서버 각각 한 대씩 배치
한 쪽 서버가 가동이 안 될 경우 다른 서버로 정상 동작시키기 위함(트래픽 처리 분산)

==서버 이미지 :==
서버가 2대 이상인 경우 사용 권장, 한 개의 서버 설치 및 설정 끝나면 서버 이미지로 만들고 같은 서버 새로 생성할 때 해당 이미지로 변장

==로드 밸런서 :==
대상 그룹에 서로 다른 가용존 서버 2대 배치
여러 서버의 트래픽 분산 외에 로깅 기능도 담당
2대 이상의 각 서버에 들어가서 로그 보는 작업은 번거로우나, 로드 밸런서 설정으로 로그 확인 가능

**DB, ACG, DB 백업, 이중화**
DB는 Private 서브넷에 위치
DB에 MySQL로 접근하기 위해서는 배스천 호스트 경유 필수
DB의 ACG에는 배스천 호스트의 Private IP 포함

DB는 중요하므로 백업 설정과 이중화 작업을 함
==멀티존 이중화== : 서로 다른 가용존에 이중화하는 방법
==Stand By Master 서버== : 한 개의 가용존 서버가 죽었을 때에만 다른 가용존 DB 역할


VPC : Virtual Private Compute
서브넷
Bastion Host : 퍼블릭 서브넷에서 서버(22 포트)및 DB 서버에 접근
ACG : Access Control Group, 방화벽 서비스

서버, 이중화, ACG, 서버이미지
NACL로 보안성 확보 Network Access Control List




---
### 클라우드 환경 이주하기

애플리케이션의 클라우드 환경 이주는 최우선 관심사임
클라우드 환경으로 이주하려면

**‘서비스로서의 인프라(Infra as a Service)’**

**‘서비스로서의 플랫폼(Platform as a Service)’**

어플리케이션의 각 컴포넌트를 하나씩 클라우드의 매니지드 서비스로 옮기는 까다로운 프로젝트를 진행해야 함

클라우드 서비스는

**IaaS**(Infrastructure as a Service)
**PaaS**(Platform as a Service)
**SaaS**(Software as a Service) 모델로 제공되며, 각각의 인프라 구성 요소가 다르다.


## ✅ 1. 클라우드 인프라 계층

### 1) 물리적 인프라 (Physical Infrastructure)

- **데이터센터**: 서버, 스토리지, 네트워크 장비 등이 위치
- **서버 하드웨어**: CPU, RAM, GPU, SSD/HDD 등
- **네트워크**: 라우터, 스위치, 방화벽 등으로 클라우드 서비스 연결

### 2) 가상화 계층 (Virtualization Layer)

- **하이퍼바이저(VMware, KVM, Hyper-V 등)**: 물리 서버에서 가상 머신(VM)을 실행
- **컨테이너(Docker, Kubernetes 등)**: 애플리케이션을 경량화된 가상 환경에서 실행

### 3) 클라우드 서비스 계층

- **IaaS (Infrastructure as a Service)**
    - 가상 머신(VM), 스토리지, 네트워크 등 기본 인프라를 제공
    - 예시: AWS EC2, Google Compute Engine, Azure Virtual Machines
- **PaaS (Platform as a Service)**
    - 애플리케이션 개발 및 실행을 위한 플랫폼을 제공 (DB, 개발 도구 포함)
    - 예시: AWS Elastic Beanstalk, Google App Engine, Heroku
- **SaaS (Software as a Service)**
    - 사용자가 직접 인프라를 관리할 필요 없이 웹 애플리케이션 형태로 제공
    - 예시: Gmail, Dropbox, Salesforce

## ✅ 2. 클라우드 배포 모델

1. **퍼블릭 클라우드** (Public Cloud)
    - 클라우드 제공업체(AWS, Azure, GCP 등)가 운영하는 공유 인프라
    - 장점: 초기 비용 절감, 확장성 우수
    - 단점: 보안 및 규제 이슈
2. **프라이빗 클라우드 (Private Cloud)**
    - 기업이 자체적으로 구축 및 운영하는 클라우드 환경
    - 장점: 높은 보안, 커스터마이징 가능
    - 단점: 높은 구축 비용
3. **하이브리드 클라우드 (Hybrid Cloud)**
    - 퍼블릭 + 프라이빗 클라우드를 혼합한 모델
    - 장점: 민감한 데이터는 프라이빗, 유연성은 퍼블릭에서 활용
4. **멀티 클라우드 (Multi-Cloud)**
    - 여러 클라우드 서비스(AWS, Azure, GCP)를 조합하여 사용
    - 장점: 특정 업체 종속 방지, 서비스 최적화

## ✅ 3. 클라우드 인프라 핵심 요소

1. **컴퓨팅 (Compute)**: 가상 머신(VM), 컨테이너, 서버리스(FaaS)
2. **스토리지 (Storage)**: 블록 스토리지, 객체 스토리지(S3), 파일 스토리지
3. **네트워크 (Networking)**: 가상 네트워크(VPC), 로드 밸런서, CDN
4. **보안(Security)**: IAM(Identity & Access Management), 방화벽, 암호화

![[Pasted image 20251205115508.png]]
![[Pasted image 20251205115516.png]]
도커를 도입한 클라우드 이주 과정이다.

특정 클라우드에 종속되지 않으므로 원하는 클라우드 서비스나 데이터센터, 로컬환경에서도 운영 가능하며 낮은 운영비와 이식성을 확보할 수 있다.

컨테이너로 애플리케이션을 이주하려면 어느 정도의 비용은 필요하다.

기존 설치 절차를 도커파일(Dockerfile) 스크립트로 작성하고

배포 관련 사항을 도커 컴포즈나 쿠버네티스에서 사용되는 애플리케이션 매니페스트로 재작성한다.

코드를 수정할 필요 없이 컨테이너화된 애플리케이션은 업무용 노트북부터 클라우드까지 어떤 환경에서든 기존과 동일한 기술 스택에서 그대로 동작한다.



