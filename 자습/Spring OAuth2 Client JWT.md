#Java 
#Spring 

---
https://cafe.naver.com/xxxjjhhh/94
개발자 유미 강의 참조

https://spring.io/guides/gs/securing-web
스프링 시큐리티 공식 문서 가이드

**실습 목표**

OAuth2.0 클라이언트와 스프링 시큐리티 6 프레임워크를 활용하여 신뢰할 수 있는 외부 사이트(구글, 네이버)로 부터 인증을 받고 전달 받은 유저 데이터를 활용하여 JWT를 발급하고 인가를 진행하는 방법

인증 받은 데이터는 MySQL 데이터베이스를 활용하여 저장하고 관리



### OAuth2 세션 방식의 동작 원리
![[Pasted image 20251120082519.png]]
**JWT 방식에서 OAuth2 클라이언트 구성시 고민점**

​JWT 방식에서는 로그인(인증)이 성공하면 JWT 발급 문제와 웹/하이브리드/네이티브앱별 특징에 의해 OAuth2 Code Grant 방식 동작의 책임을 프론트엔드 측에 둘 것인지 백엔드 측에 둘 것인지 많은 고민을 함

**- 로그인(인증)이 성공하면 JWT를 발급해야 하는 문제**
- 프론트단에서 로그인 경로에 대한 하이퍼링크를 실행하면 소셜 로그인창이 등장하고 로그인 로직이 수행됨

- 로그인이 성공되면 JWT가 발급되는데 하이퍼링크로 실행했기 때문에 JWT를 받을 로직이 없음 
	(해당 부분에 대해 redirect_url 설정에 따라 많은 고민이 필요)

- API Client(axios, fetch)로 요청 -> 백엔드측으로 요청이 전송되지만 외부 서비스 로그인 페이지 확인 불가

**- 웹/하이브리드/네이티브앱별 특징**

- 웹에서 편하게 사용할 수 있는 웹페이지가 앱에서는 웹뷰로 보이기 때문에 UX적으로 안좋은 경험

- 앱 환경에서 쿠키 소멸 현상

위와 같은 문제로 OAuth2 Code Grant 방식 동작에 대한 redirect_url, Access 토큰 발급 문제를 어느단에서 처리해야 하는지에 대한 구현이 많고 넷상에 잘못된 구현 방법도 많이 존재

잘못된 구현 방법과 구현되어 있는 모든 방법:

#### **프론트/백 책임 분배 (웹에서)**

**- 모든 책임을 프론트가 맡음**
![[Pasted image 20251201080642.png]]
프론트단에서 (로그인 → 코드 발급 → Access 토큰 → 유저 정보 획득) 과정을 모두 수행한 뒤 백엔드단에서 (유저 정보 → JWT 발급) 방식으로 주로 네이티브앱에서 사용하는 방식.

→ 프론트에서 보낸 유저 정보의 진위 여부를 따지기 위해 추가적인 보안 로직이 필요

**- 책임을 프론트와 백엔드가 나누어 가짐** : 잘못된 방식 (대부분의 웹 블로그가 이 방식으로 구현)

**- 프론트단에서 (로그인 → 코드 발급) 후 코드를 백엔드로 전송,
  백엔드단에서 (코드 → 토큰 발급 → 유저 정보 획득 → JWT 발급)**

![[Pasted image 20251201080807.png]]

**-** **프론트단에서 (로그인 → 코드 발급 → Access 토큰) 후 Access 토큰을 백엔드로 전송,
  백엔드단에서 (Access 토큰 → 유저 정보 획득 → JWT 발급)**

![[Pasted image 20251201081306.png]]
카카오와 같은 대형 서비스 개발 포럼 및 보안 규격에서 위와 같은 코드/Access 토큰을 전송하는 방법을 지양 (하지만 토이로 구현하기 쉬워 자주 사용)

**- 모든 책임을 백엔드가 맡음***
![[Pasted image 20251201081446.png]]

프론트단에서 백엔드의 OAuth2 로그인 경로로 하이퍼링킹을 진행 후 백엔드단에서 (로그인 페이지 요청 → 코드 발급 → Access 토큰 → 유저 정보 획득 → JWT 발급) 방식으로 주로 웹앱/모바일앱 통합 환경 서버에서 사용하는 방식.

→ 백엔드에서 JWT를 발급하는 방식의 고민과 프론트측에서 받는 로직을 처리해야 한다.


**우리가 구현할 방식**

우리 채널은 백엔드에 초점
모든 책임을 백엔드에서 맡아 (로그인 페이지 요청 → 코드 발급 → Access 토큰 → 유저 정보 획득 → JWT 발급)로직을 모두 스프링 쪽에서 처리할 것

앱에 대해서는 모든 책임을 프론트가 일임하고 코드나 Access 토큰을 전달하는 행위 자체를 지양
추가적으로 다른 자료들에도 코드나 Access 토큰을 전달하는 행위를 금지중

### 동작 모식도
![[Pasted image 20251201083105.png]]
**OAuth2 소셜 로그인을 위한 변수 설정**

application.properties -> registration, provider 등록


